# Mission Control â€” Final Implementation Plan

> **Goal**: Multi-company, multi-agent command center. Single pane of glass for businesses, agents, social media, leads, costs, and knowledge. Product-ready from day one.

---

## Tech Stack

| Layer | Tech |
|---|---|
| **Framework** | Next.js 15 (App Router) + TypeScript |
| **Database** | Supabase (Postgres + Realtime + Auth) |
| **Styling** | Tailwind CSS v4 |
| **Components** | shadcn/ui |
| **Icons** | Lucide React (bundled with shadcn) |
| **AI Models** | OpenRouter (unified gateway to all models) |
| **Agent Comms** | OpenClaw Gateway â€” WebSocket on port `18789` |
| **State** | React hooks + Supabase real-time subscriptions |

---

## Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     MISSION CONTROL                      â”‚
â”‚                    (Next.js 15 App)                       â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚    FRONTEND       â”‚  â”‚    BACKEND (API Routes)      â”‚  â”‚
â”‚  â”‚                   â”‚  â”‚                              â”‚  â”‚
â”‚  â”‚  React pages      â”‚  â”‚  /api/agents/*     â†’ WS mgmtâ”‚  â”‚
â”‚  â”‚  shadcn + TW v4   â”‚  â”‚  /api/workspaces/* â†’ CRUD   â”‚  â”‚
â”‚  â”‚  Client componentsâ”‚  â”‚  /api/social/*     â†’ posts   â”‚  â”‚
â”‚  â”‚                   â”‚  â”‚  /api/models/*     â†’ OR API  â”‚  â”‚
â”‚  â”‚  Never touches    â”‚  â”‚  /api/costs/*      â†’ finance â”‚  â”‚
â”‚  â”‚  secrets directly â”‚  â”‚  /api/brain/*      â†’ KB      â”‚  â”‚
â”‚  â”‚                   â”‚  â”‚                              â”‚  â”‚
â”‚  â”‚  Calls /api/*     â”‚  â”‚  Holds all secrets           â”‚  â”‚
â”‚  â”‚  endpoints only   â”‚  â”‚  server-side only            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
                    â–¼               â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Supabase  â”‚   â”‚ OpenClaw Gateway  â”‚
              â”‚ (DB +     â”‚   â”‚ ws://host:18789   â”‚
              â”‚ Realtime) â”‚   â”‚ (local Mac or     â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  Docker container) â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â–¼                 â–¼
                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚ OpenRouter â”‚     â”‚ Direct    â”‚
                       â”‚ (models)   â”‚     â”‚ Provider  â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Why Next.js API Routes as the Backend

> [!IMPORTANT]
> We do **not** need a separate backend server. Next.js API routes (`/api/*`) run server-side and give us:

- **Secret isolation** â€” Supabase service key, OpenRouter API key, device tokens never reach the browser
- **Server-only DB access** â€” All Supabase mutations go through API routes using the service role key
- **WebSocket management** â€” Agent connections are managed server-side
- **API proxy** â€” OpenRouter calls, social platform APIs all proxied through our routes
- **Middleware** â€” Request validation, rate limiting, auth checks at the edge

The frontend is pure React client components that call these API routes. Zero secrets on the client.

---

## Security Architecture

| Layer | How |
|---|---|
| **Supabase credentials** | `SUPABASE_URL` + `SUPABASE_SERVICE_ROLE_KEY` in `.env.local` â€” server-side only |
| **OpenRouter API key** | Stored in `.env.local`, proxied via `/api/models/*` routes |
| **OpenClaw device tokens** | Encrypted at rest in `agents` table. Decrypted server-side only when opening WebSocket |
| **Social platform tokens** | Stored encrypted in `integrations` table. Used server-side only |
| **Row Level Security (RLS)** | Enabled on all Supabase tables. Service role bypasses for API routes |
| **Client auth** | For now: local-only (no auth needed). Later: Supabase Auth with JWT for multi-user/SaaS |
| **CORS** | API routes only accept requests from `localhost:3000` in dev |

> [!TIP]
> When this becomes a product, we add Supabase Auth + RLS policies scoped to `auth.uid()`. The architecture doesn't change â€” we just swap the service key calls for user-scoped calls.

---

## OpenClaw Integration

### How It Works

```
Mission Control                    OpenClaw Instance
(Next.js API route)                (running on your Mac)
       â”‚                                  â”‚
       â”‚â”€â”€ ws://localhost:18789 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
       â”‚   { type: "pair", ... }          â”‚
       â”‚â—„â”€ { deviceToken: "abc..." } â”€â”€â”€â”€â”€â”‚
       â”‚                                  â”‚
       â”‚â”€â”€ { type: "command",             â”‚
       â”‚     payload: "do X" } â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
       â”‚â—„â”€ { type: "event",              â”‚
       â”‚     data: { ... } } â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
       â”‚                                  â”‚
       â”‚   Mission Control writes         â”‚
       â”‚   events to Supabase             â”‚
       â”‚   agent_activity table           â”‚
```

### Deployment Model

| Phase | OpenClaw runs | Mission Control runs |
|---|---|---|
| **Now** | Directly on Mac (`localhost:18789`) | Locally (`localhost:3000`) |
| **Later (multi-agent)** | Multiple Docker containers on different ports | Still locally |
| **Production** | Docker containers (any host) | Vercel / Railway / self-hosted |

Mission Control connects to each agent by its host:port. For local Mac: `ws://localhost:18789`. For Docker: `ws://localhost:18790`, `18791`, etc. or remote hosts.

---

## Design System

Tailwind CSS v4 with CSS-first configuration. shadcn/ui components styled to match the dark elevation system.

| Token | Value | Usage |
|---|---|---|
| `--background` | `#121212` | Page background |
| `--card` | `#1E1E1E` | Card surfaces |
| `--sidebar` | `#0D0D0D` | Sidebar (deepest) |
| `--muted` | `#252525` | Hover, inputs |
| `--accent` | `#2A2A2A` | Elevated surfaces |
| `--primary` | `#E5850F` | Orange â€” CTAs, agent tags |
| `--info` | `#5A9CF5` | Blue â€” secondary, info |
| `--success` | `#2ECC8F` | Green â€” online, complete |
| `--destructive` | `#D95555` | Red â€” errors, danger |

Text opacity: `0.87` primary â†’ `0.60` body â†’ `0.38` muted â†’ `0.25` disabled. Borders over shadows. `fade-in` animations with stagger.

---

## Pages (9 + Settings)

> [!IMPORTANT]
> Every page is **operational**. Sophisticated, not overloaded.

---

### 1. ğŸ  Command Center `/`

| Element | Purpose |
|---|---|
| **Workspace summary cards** | One per company â€” agents, leads, tasks, spend |
| **Agent fleet strip** | All agents: status, current task, workspace tag |
| **Activity stream** | Real-time feed via Supabase subscriptions |
| **âŒ˜K Command palette** | Global quick actions |

---

### 2. ğŸ¤– Agents `/agents`

| Element | Purpose |
|---|---|
| **Agent cards** | Name, workspace, status, current task, model, uptime |
| **Detail panel** | Live logs, task queue, memory, config |
| **Direct command** | Send instructions via WebSocket |
| **Agent actions** | Start / Stop / Restart / Reassign |
| **Add agent** | Host, port, pair to get device token |

---

### 3. ğŸ§  Models & AI `/models`

| Element | Purpose |
|---|---|
| **Model registry** | Browse OpenRouter models, filter by provider/cost |
| **Agent-model mapping** | Default model per agent + complexity overrides |
| **Complexity tiers** | Light / Standard / Heavy â†’ each maps to a model |
| **API keys** | OpenRouter key, or direct provider keys |
| **Usage + balance** | Tokens per model, credit balance |

---

### 4. ğŸ“Š Projects `/projects`

| Element | Purpose |
|---|---|
| **Workspace tabs** | Filter by company or "All" |
| **Project cards** | Progress, agents, due date, task counts |
| **Project detail** | Kanban columns, milestones, notes |
| **Create project** | Modal with workspace + agent assignment |

---

### 5. ğŸ“± Social & Leads `/social`

| Element | Purpose |
|---|---|
| **Content calendar** | Scheduled/published posts across platforms |
| **Post composer** | Write, select platforms, schedule. AI can draft |
| **Engagement metrics** | Per-platform trends (7d/30d/90d) |
| **Lead pipeline** | Kanban: New â†’ Contacted â†’ Qualified â†’ Proposal â†’ Won/Lost |
| **Manual lead add** | LinkedIn initially, extensible |

---

### 6. ğŸ§  Knowledge Base `/brain`

| Element | Purpose |
|---|---|
| **Scope toggle** | Workspace vs. Global |
| **Quick add** | Text + URL + file drop |
| **Search** | Full-text across all knowledge |
| **Collections** | Grouped knowledge sets |

---

### 7. ğŸ’° Finance & Costs `/costs`

| Element | Purpose |
|---|---|
| **Cost overview** | Total spend, per workspace & agent, MoM change |
| **Agent cost table** | Model, tokens, API cost per agent |
| **Budget alerts** | Monthly limits, visual warnings |
| **Cost timeline** | Trend chart with workspace toggle |
| **Expense log** | Manual entries for subs, freelancers, ads |

---

### 8. ğŸ“ˆ Analytics `/analytics`

| Element | Purpose |
|---|---|
| **Date range** | 7d / 30d / 90d / Custom |
| **Agent performance** | Tasks, response times, error rates |
| **Lead funnel** | Conversion rates per stage |
| **Project velocity** | Tasks/week, on-track vs behind |
| **Workspace comparison** | Side-by-side KPIs |

---

### 9. âš™ï¸ Settings `/settings`

| Sub-section | Purpose |
|---|---|
| **Workspaces** | CRUD companies (dynamic, add anytime) |
| **Agent config** | System prompt, model, memory per agent |
| **Integrations** | Social platforms, external tools, status |
| **Agent connections** | Host:port config (localhost now, Docker later) |
| **Model pricing** | Cost-per-token for auto cost calculation |
| **Security** | Manage encrypted tokens, rotate keys |

---

## Supabase Schema

| Table | Purpose |
|---|---|
| `workspaces` | Companies â€” name, colour, description |
| `agents` | Instances â€” host, port, encrypted_device_token, workspace_id, status |
| `agent_activity` | Events â€” heartbeats, messages, tool calls, tokens_used |
| `projects` | Projects scoped to workspaces |
| `project_tasks` | Tasks â€” status, assignee, priority |
| `social_accounts` | Connected platforms per workspace |
| `social_posts` | Scheduled/published content |
| `social_analytics` | Engagement metrics per post |
| `leads` | Pipeline â€” source, stage, deal_value, workspace |
| `knowledge_base` | Facts, notes, files, collection tags |
| `bot_config` | Agent personality + settings |
| `integrations` | Connected services + encrypted auth tokens |
| `cost_entries` | Cost records â€” category, amount, workspace, agent |
| `budgets` | Monthly limits per workspace/agent |
| `model_config` | Model registry â€” provider, model_id, cost_per_token, tier |
| `encryption_keys` | Key management for token encryption |

---

## Backend API Routes

```
/api/
â”œâ”€â”€ workspaces/
â”‚   â”œâ”€â”€ route.ts          # GET (list), POST (create)
â”‚   â””â”€â”€ [id]/route.ts     # GET, PUT, DELETE
â”œâ”€â”€ agents/
â”‚   â”œâ”€â”€ route.ts          # GET (list), POST (register + pair)
â”‚   â”œâ”€â”€ [id]/route.ts     # GET, PUT, DELETE
â”‚   â”œâ”€â”€ [id]/command/route.ts   # POST â€” send instruction via WS
â”‚   â””â”€â”€ [id]/logs/route.ts      # GET â€” stream activity
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ route.ts          # GET available models (proxy OpenRouter)
â”‚   â”œâ”€â”€ config/route.ts   # GET/PUT agent-model mappings
â”‚   â””â”€â”€ usage/route.ts    # GET token usage + credit balance
â”œâ”€â”€ projects/
â”‚   â”œâ”€â”€ route.ts          # CRUD
â”‚   â””â”€â”€ [id]/tasks/route.ts
â”œâ”€â”€ social/
â”‚   â”œâ”€â”€ posts/route.ts    # CRUD + schedule
â”‚   â”œâ”€â”€ accounts/route.ts # Connect/disconnect platforms
â”‚   â””â”€â”€ analytics/route.ts
â”œâ”€â”€ leads/route.ts        # CRUD + pipeline stage updates
â”œâ”€â”€ brain/route.ts        # CRUD knowledge entries
â”œâ”€â”€ costs/
â”‚   â”œâ”€â”€ route.ts          # GET cost data + POST manual entries
â”‚   â””â”€â”€ budgets/route.ts  # GET/PUT budget limits
â””â”€â”€ analytics/route.ts    # GET aggregated metrics
```

All routes use `SUPABASE_SERVICE_ROLE_KEY` server-side. No secrets exposed to the client.

---

## Product-Ready Notes

> [!NOTE]
> Built for future SaaS conversion:

- **Multi-tenancy** â€” workspace isolation, natural path to user teams
- **Config-driven integrations** â€” nothing hardcoded
- **OpenRouter default** â€” one credit pool, all models
- **Pluggable agent protocol** â€” OpenClaw today, extendable
- **shadcn/ui** â€” professional component library, easy to theme and white-label
- **Server-side security** â€” secrets never touch the browser

---

## ğŸš€ Build Order

| Phase | What | Why this order |
|---|---|---|
| **1** | **Scaffold** | `create-next-app`, Tailwind v4, shadcn init, design tokens |
| **2** | **Backend foundation** | Supabase client (server), `.env.local`, base API route helpers |
| **3** | **Sidebar + Layout + Workspace Switcher** | The shell â€” everything hangs off this |
| **4** | **Settings** | CRUD workspaces + agent connection config |
| **5** | **Agents + Gateway** | WebSocket client, pair with local OpenClaw, prove connectivity |
| **6** | **Models & AI** | OpenRouter integration, agent-model config |
| **7** | **Command Center** | Unified overview with live data |
| **8** | **Projects** | Core operational capability |
| **9** | **Social & Leads** | Revenue operations |
| **10** | **Finance & Costs** | Spending visibility |
| **11** | **Analytics** | Cross-company insights |
| **12** | **Knowledge Base** | Second brain |

> [!IMPORTANT]
> **Phases 1â€“5 establish the gateway.** Scaffold â†’ backend â†’ shell â†’ config â†’ agent connection. Once an agent talks back, everything else is data flowing through that pipe.

---

## File Structure

```
mission-control/
â”œâ”€â”€ public/
â”‚   â””â”€â”€ logo.png
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ globals.css              # Tailwind v4 + design tokens
â”‚   â”‚   â”œâ”€â”€ layout.tsx               # Root layout with sidebar
â”‚   â”‚   â”œâ”€â”€ page.tsx                 # Command Center
â”‚   â”‚   â”œâ”€â”€ agents/page.tsx
â”‚   â”‚   â”œâ”€â”€ models/page.tsx
â”‚   â”‚   â”œâ”€â”€ projects/page.tsx
â”‚   â”‚   â”œâ”€â”€ social/page.tsx
â”‚   â”‚   â”œâ”€â”€ brain/page.tsx
â”‚   â”‚   â”œâ”€â”€ costs/page.tsx
â”‚   â”‚   â”œâ”€â”€ analytics/page.tsx
â”‚   â”‚   â”œâ”€â”€ settings/page.tsx
â”‚   â”‚   â””â”€â”€ api/                     # â† THE BACKEND
â”‚   â”‚       â”œâ”€â”€ workspaces/
â”‚   â”‚       â”œâ”€â”€ agents/
â”‚   â”‚       â”œâ”€â”€ models/
â”‚   â”‚       â”œâ”€â”€ projects/
â”‚   â”‚       â”œâ”€â”€ social/
â”‚   â”‚       â”œâ”€â”€ leads/
â”‚   â”‚       â”œâ”€â”€ brain/
â”‚   â”‚       â”œâ”€â”€ costs/
â”‚   â”‚       â””â”€â”€ analytics/
â”‚   â”œâ”€â”€ components/                  # shadcn + custom
â”‚   â”‚   â”œâ”€â”€ ui/                      # shadcn components
â”‚   â”‚   â”œâ”€â”€ Sidebar.tsx
â”‚   â”‚   â”œâ”€â”€ CommandPalette.tsx
â”‚   â”‚   â””â”€â”€ WorkspaceSwitcher.tsx
â”‚   â””â”€â”€ lib/
â”‚       â”œâ”€â”€ supabase-server.ts       # Service role client (server only)
â”‚       â”œâ”€â”€ supabase-client.ts       # Anon client (realtime subscriptions)
â”‚       â”œâ”€â”€ gateway.ts               # OpenClaw WebSocket client
â”‚       â”œâ”€â”€ openrouter.ts            # OpenRouter API client
â”‚       â””â”€â”€ encryption.ts            # Token encryption utilities
â”œâ”€â”€ .env.local                       # All secrets here
â”œâ”€â”€ components.json                  # shadcn config
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â””â”€â”€ next.config.ts
```

---

## Verification Plan

### Automated
- `npm run build` â€” zero errors
- `npm run lint` â€” clean

### Browser Testing
- All pages render with dark mode
- Workspace switcher filters data
- CRUD on workspaces, projects, leads, knowledge
- âŒ˜K command palette from every page
- Agent WebSocket connection (local OpenClaw)

### Security Check
- Verify no secrets in client bundle (`next build` + inspect)
- API routes reject requests without proper headers
- Encrypted tokens in Supabase are not readable via client
